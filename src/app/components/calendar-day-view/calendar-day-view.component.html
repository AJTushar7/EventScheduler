<div class="calendar-container">
  <!-- Time Conflict Alert -->
  <div class="conflict-alert" [style.display]="currentOverlap.hasOverlap ? 'flex' : 'none'">
    <div class="alert-icon">⚠️</div>
    <div class="alert-content">
      <strong>Time Conflict:</strong>
      <p>{{ getConflictMessage() }}</p>
      <p>Please select a time outside this range.</p>
    </div>
  </div>

  <!-- Time Headers -->
  <div class="time-header">
    <div 
      class="time-slot" 
      *ngFor="let slot of timeSlots" 
      [attr.data-hour]="slot.hour"
      (click)="onTimeSlotClick($event, slot.hour)">
      {{ slot.label }}
    </div>
  </div>

  <!-- Event Table -->
  <div class="event-table">
    <!-- Existing Events Row -->
    <div class="event-row existing-row" id="existing-events">
      <div class="row-cell" *ngFor="let slot of timeSlots"></div>
      
      <!-- Existing Event Blocks -->
      <div 
        *ngFor="let event of getExistingEvents()" 
        class="event-block booked"
        [style.left]="calculateEventPosition(event).left + '%'"
        [style.width]="calculateEventPosition(event).width + '%'">
        {{ formatTime(event.startTime) }} - {{ formatTime(event.endTime) }}
      </div>
    </div>

    <!-- New Event Row -->
    <div class="event-row new-row" id="new-events" 
         (mousemove)="isScheduling ? onSchedulingMouseMove($event, 0) : null">
      <div class="row-cell" *ngFor="let slot of timeSlots"></div>
      
      <!-- New Event Blocks -->
      <div 
        *ngFor="let event of getNewEvents()" 
        class="event-block new-event"
        [style.left]="calculateEventPosition(event).left + '%'"
        [style.width]="calculateEventPosition(event).width + '%'">
        {{ formatTime(event.startTime) }} - {{ formatTime(event.endTime) }}
      </div>
      
      <!-- Scheduling Preview -->
      <div 
        *ngIf="isScheduling && getSchedulingEventPosition()" 
        class="event-block scheduling-preview"
        [class.conflict]="currentOverlap.hasOverlap"
        [style.left]="getSchedulingEventPosition()!.left + '%'"
        [style.width]="getSchedulingEventPosition()!.width + '%'">
        {{ formatTime(schedulingStartTime) }} - {{ formatTime(schedulingEndTime) }}
      </div>
    </div>
  </div>

  <!-- Execution Controls -->
  <div class="execution-controls">
    <div class="control-group">
      <label for="execution-time">Execution Start Time</label>
      <select id="execution-time" [(ngModel)]="selectedExecutionTime" (change)="updateExecutionTime()">
        <option value="09:00">09:00</option>
        <option value="09:15">09:15</option>
        <option value="09:30">09:30</option>
        <option value="09:45">09:45</option>
        <option value="10:00">10:00</option>
        <option value="10:15">10:15</option>
        <option value="10:30">10:30</option>
        <option value="10:45">10:45</option>
        <option value="11:00">11:00</option>
        <option value="11:15">11:15</option>
        <option value="11:30">11:30</option>
        <option value="11:33">11:33</option>
        <option value="11:45">11:45</option>
        <option value="12:00">12:00</option>
        <option value="12:15">12:15</option>
        <option value="12:30">12:30</option>
        <option value="12:33">12:33</option>
        <option value="12:45">12:45</option>
        <option value="12:47">12:47</option>
        <option value="13:00">13:00</option>
        <option value="13:15">13:15</option>
        <option value="13:30">13:30</option>
        <option value="13:45">13:45</option>
        <option value="14:00">14:00</option>
        <option value="14:07">14:07</option>
        <option value="14:15">14:15</option>
        <option value="14:30">14:30</option>
        <option value="14:45">14:45</option>
        <option value="15:00">15:00</option>
        <option value="15:07">15:07</option>
        <option value="15:15">15:15</option>
        <option value="15:30">15:30</option>
        <option value="15:45">15:45</option>
        <option value="16:00">16:00</option>
        <option value="16:15">16:15</option>
        <option value="16:30">16:30</option>
        <option value="16:45">16:45</option>
        <option value="17:00">17:00</option>
        <option value="17:15">17:15</option>
        <option value="17:30">17:30</option>
        <option value="17:45">17:45</option>
        <option value="18:00">18:00</option>
        <option value="18:15">18:15</option>
        <option value="18:30">18:30</option>
        <option value="18:45">18:45</option>
        <option value="19:00">19:00</option>
        <option value="19:15">19:15</option>
        <option value="19:30">19:30</option>
        <option value="19:45">19:45</option>
        <option value="20:00">20:00</option>
      </select>
    </div>

    <div class="action-buttons">
      <button class="btn btn-cancel" (click)="cancelScheduling()">Cancel</button>
      <button class="btn btn-confirm" (click)="confirmScheduling()">Confirm</button>
    </div>
  </div>
</div>